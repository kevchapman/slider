!function(a){"use strict";function b(b,c){if(b.length){var d={next:"a.next",prev:"a.prev",paging:"div.slider_paging",scroll:"div.slider_scroll",mask:"div.slider_mask",items:"div.slider_item",touch:!0,speed:200,offset:0,autoInit:!0,row:1,extendLayout:!1,callback:!1,css3:!0,resizeItems:!0,startItem:0,threshold:.4,jsonFeed:!1,jsonData:!1,views:{item:function(a){return'<div class="slider_item">'+a.Content+"</div>"}}},e=a.extend({},d,c);return this.opts=e,this.index=0,this.ele=b,this.mask=this.ele.find(e.mask),this.scroller=this.ele.find(e.scroll),this.items=this.scroller.find(e.items),this.btnNext=this.ele.find(e.next),this.btnPrev=this.ele.find(e.prev),this.pagingNav=this.ele.find(e.paging),this.x=0,this.y=0,this.css3=e.touch&&e.css3&&"webkitTransform"in this.ele[0].style,e.autoInit&&this.init(),this}}b.prototype={init:function(){var a=this;return this.btnNext.click(function(){return a.stop(),a.next(),!1}),this.btnPrev.click(function(){return a.stop(),a.prev(),!1}),this.opts.auto&&(this.start(),this.ele.on({mouseenter:function(){a.pause()},mouseleave:function(){a.start()}})),this.layout(),this.pagingNav&&this.initPaging(),this.setBtnStatus(),this.goTo(this.opts.startItem),this.opts.jsonData&&this.updateView(this.opts.jsonData),this.opts.touch&&this.bindTouch(),this},layout:function(){var b=this,c=b.mask.width(),d=(b.opts.row-1)*2*b.opts.offset,e=b.opts.row>1?(c-d)/b.opts.row:c;this.maskW=c,this.items=this.scroller.find(this.opts.items),this.items.css({"float":"left",marginLeft:b.opts.offset,marginRight:b.opts.offset}),this.opts.resizeItems&&this.items.width(e),this.totalW=function(b){var c=0;return b.items.each(function(){c+=a(this).outerWidth(!0)}),c}(this),this.itemW=b.items.outerWidth(!0)*b.opts.row,this.total=b.items.length/b.opts.row,this.scroller.width(b.total*b.itemW).css({marginLeft:-b.offset}),this.parent&&!b.pagingNav?b.parent.setHeight():"",this.opts.extendLayout&&this.opts.extendLayout()},getIndex:function(){return this.index<=0?this.index=0:this.index>this.total-1&&(this.index=this.opts.auto?0:this.total-1),this.index},bindTouch:function(){var a=this;this.total<=1||(this.scroller[0].ontouchstart=function(b){return a.opts.auto?a.stop():"",1!=b.targetTouches.length||1!=event.touches.length?!1:(a.scroller[0].style.webkitTransition="",a.startX=b.targetTouches[0].clientX,a.cTouch=a.startX,a.startY=b.targetTouches[0].clientY,a.getPosition(a.scroller[0].style.webkitTransform),void 0)},this.scroller[0].ontouchmove=function(b){if(1!==b.targetTouches.length)return!1;if(1!==b.targetTouches.length||1!==event.touches.length)return!1;var c=b.targetTouches[0].clientX-a.startX;Math.abs(c)>5?b.preventDefault():"",a.move(c,0),a.cTouch=b.targetTouches[0].clientX},this.scroller[0].ontouchend=function(b){var c=a.startX-a.cTouch,d=a.mask.width()*a.opts.threshold;return b.preventDefault(),b.targetTouches.length>0||b.touches.length>0?!1:(c>d?a.next():-d>c?a.prev():a.goTo(a.getIndex()),void 0)})},next:function(){this.index++,this.goTo(this.getIndex())},prev:function(){this.index--,this.goTo(this.getIndex())},start:function(){if(this.opts.auto){var a=this;this.timer=setInterval(function(){a.next()},this.opts.auto)}},stop:function(){this.opts.auto&&(clearInterval(this.timer),this.opts.auto=!1)},pause:function(){this.opts.auto&&clearInterval(this.timer)},aMove:function(a,b){function c(){d.index=a,d.opts.callback&&d.opts.callback(d),d.setActive()}var d=this,e=(b||0===b?b:this.itemW*a)+d.opts.offset,f=e+this.maskW;return f>this.totalW&&(e=this.totalW-this.mask.width()),this.css3?(this.scroller[0].style.webkitTransition="-webkit-transform "+this.opts.speed+"ms ease",this.scroller[0].style.webkitTransform="translate3d(-"+e+"px,0,0)",this.scroller.one("webkitTransitionEnd",function(){d.getPosition(this.style.webkitTransform),this.style.webkitTransition="",c()}),void 0):(this.scroller.animate({left:-e},this.opts.speed,function(){c()}),void 0)},move:function(a){var b=parseInt(this.x+a);this.scroller[0].style.webkitTransform="translate3d("+b+"px,0,0)"},goTo:function(a){(a||0===a)&&(this.index=parseInt(a),this.aMove(a),this.setBtnStatus())},initPaging:function(){var b='<ul class="sliderPaging">',c=this;if(this.total>1){for(var d=0;d<this.total;d++)b+='<li><a href="#"><span>'+parseInt(d)+"</span></a></li>";this.pagingNav.html(b+"</ul>"),this.pagingLinks=this.pagingNav.find("a"),this.pagingLinks.click(function(){return c.stop(),c.goTo(a(this).find("span").text()),!1}),this.setActive()}c.parent?c.parent.setHeight():""},setActive:function(){var b=this.pagingLinks||[];b.length&&(b.filter(".active").removeClass("active"),a(b[this.index]).addClass("active"))},setBtnStatus:function(){0===this.index?(this.btnPrev.addClass("disabled"),this.btnNext.removeClass("disabled"),1===this.total&&this.btnNext.addClass("disabled")):this.index>=this.total-1?(this.btnNext.addClass("disabled"),this.btnPrev.removeClass("disabled")):this.btnPrev.add(this.btnNext).removeClass("disabled")},getPosition:function(a){var b=a.replace(/[a-z]/g,"").replace("3(","").replace(")","").split(",")||[0,0,0];this.x=parseInt(b[0]),this.y=parseInt(b[1])},reInit:function(a){var b=a||this.getIndex();this.items=this.scroller.find(this.itemsSelect),this.total=Math.ceil(this.items.length/this.row),this.layout(),this.scroller.width(this.total*this.itemW),"first"===b&&(b=0),this.goTo(b),this.pagingNav.length&&this.initPaging(),this.setBtnStatus()},getJson:function(){if(this.opts.jsonFeed){var b=this;a.ajax({url:this.opts.jsonFeed,dataType:"json",success:function(a){b.updateView(a)}})}},updateView:function(a){var b,c=a.length,d="";for(b=0;c>b;b++)d+=this.opts.views.item(a[b]);this.scroller.html(d),this.reInit(0)}},a.fn.slider=function(c){return this.each(function(){a(this).data().slider=new b(a(this),c)})}}(jQuery);